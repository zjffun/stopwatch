(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
  typeof define === 'function' && define.amd ? define(factory) :
  (global = global || self, global.stopwatch2 = factory());
}(this, (function () { 'use strict';

  var isNode = new Function("try {return this===global;}catch(e){return false;}");
  var isBrowser = new Function(
    "try {return this===self;}catch(e){ return false;}"
  );

  let _performance = null,
    _global = null;

  if (isNode()) {
    _performance = require("perf_hooks").performance;
    _global = global;
  } else if (isBrowser()) {
    _performance = performance;
    _global = self;
  } else {
    throw Error(`unknow environment!`);
  }

  const players = Symbol("players");

  const states = {
    start: Symbol("start"),
    pause: Symbol("pause"),
    stop: Symbol("stop"),
  };

  const stopwatchs = {};

  /**
   * Factory
   * @param {String} groupName groupName
   */
  function stopwatch (groupName) {
    if (stopwatchs[groupName]) {
      return stopwatchs[groupName];
    }

    const stopwatch = (stopwatchs[groupName] = {
      [players]: {},

      /**
       * Start time
       * @param {String} tag tag
       */
      start(tag) {
        if (!stopwatch[players][tag]) {
          stopwatch[players][tag] = {
            start: _performance.now(),
            execTime: 0,
            state: states.start,
          };
          return;
        }
        const player = stopwatch[players][tag];

        if (player.state === states.stop) {
          player.execTime = 0;
        }
        player.start = _performance.now();
        player.state = states.start;
      },

      /**
       * Pause time
       * @param {String} tag tag
       */
      pause(tag) {
        if (!stopwatch[players][tag]) {
          console.error(`"${tag}" does not exist`);
          return;
        }

        const player = stopwatch[players][tag];

        let runTime = 0;
        if (player.state === states.start) {
          runTime = _performance.now() - player.start;
          player.execTime += runTime;
        }
        player.state = states.pause;

        return runTime;
      },

      /**
       * Stop time
       * @param {String} tag tag
       */
      stop(tag) {
        if (!stopwatch[players][tag]) {
          console.error(`"${tag}" does not exist`);
          return;
        }

        const player = stopwatch[players][tag];
        stopwatch.pause(tag);
        player.state = states.stop;
        console.log(`${tag}: ${player.execTime}ms`);
        return player.execTime;
      },

      /**
       * Suspends the execution
       * @param {Number} ms Number of millisecond
       */
      sleep(ms) {
        const start = Date.now();
        while (Date.now() - start < ms) {}
      },

      /**
       * List all palyers
       * @returns {Array} palyers
       */
      list() {
        const copy = JSON.parse(JSON.stringify(stopwatch[players]));
        console.log(copy);
        return copy;
      },

      /**
       * Clear all palyers
       */
      clear() {
        stopwatch[players] = {};
        return true;
      },
    });

    return stopwatch;
  }

  return stopwatch;

})));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzIjpbInNyYy9zdG9wd2F0Y2guanMiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIGlzTm9kZSA9IG5ldyBGdW5jdGlvbihcInRyeSB7cmV0dXJuIHRoaXM9PT1nbG9iYWw7fWNhdGNoKGUpe3JldHVybiBmYWxzZTt9XCIpO1xyXG52YXIgaXNCcm93c2VyID0gbmV3IEZ1bmN0aW9uKFxyXG4gIFwidHJ5IHtyZXR1cm4gdGhpcz09PXNlbGY7fWNhdGNoKGUpeyByZXR1cm4gZmFsc2U7fVwiXHJcbik7XHJcblxyXG5sZXQgX3BlcmZvcm1hbmNlID0gbnVsbCxcclxuICBfZ2xvYmFsID0gbnVsbDtcclxuXHJcbmlmIChpc05vZGUoKSkge1xyXG4gIF9wZXJmb3JtYW5jZSA9IHJlcXVpcmUoXCJwZXJmX2hvb2tzXCIpLnBlcmZvcm1hbmNlO1xyXG4gIF9nbG9iYWwgPSBnbG9iYWw7XHJcbn0gZWxzZSBpZiAoaXNCcm93c2VyKCkpIHtcclxuICBfcGVyZm9ybWFuY2UgPSBwZXJmb3JtYW5jZTtcclxuICBfZ2xvYmFsID0gc2VsZjtcclxufSBlbHNlIHtcclxuICB0aHJvdyBFcnJvcihgdW5rbm93IGVudmlyb25tZW50IWApO1xyXG59XHJcblxyXG5jb25zdCBwbGF5ZXJzID0gU3ltYm9sKFwicGxheWVyc1wiKTtcclxuXHJcbmNvbnN0IHN0YXRlcyA9IHtcclxuICBzdGFydDogU3ltYm9sKFwic3RhcnRcIiksXHJcbiAgcGF1c2U6IFN5bWJvbChcInBhdXNlXCIpLFxyXG4gIHN0b3A6IFN5bWJvbChcInN0b3BcIiksXHJcbn07XHJcblxyXG5jb25zdCBzdG9wd2F0Y2hzID0ge307XHJcblxyXG4vKipcclxuICogRmFjdG9yeVxyXG4gKiBAcGFyYW0ge1N0cmluZ30gZ3JvdXBOYW1lIGdyb3VwTmFtZVxyXG4gKi9cclxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gKGdyb3VwTmFtZSkge1xyXG4gIGlmIChzdG9wd2F0Y2hzW2dyb3VwTmFtZV0pIHtcclxuICAgIHJldHVybiBzdG9wd2F0Y2hzW2dyb3VwTmFtZV07XHJcbiAgfVxyXG5cclxuICBjb25zdCBzdG9wd2F0Y2ggPSAoc3RvcHdhdGNoc1tncm91cE5hbWVdID0ge1xyXG4gICAgW3BsYXllcnNdOiB7fSxcclxuXHJcbiAgICAvKipcclxuICAgICAqIFN0YXJ0IHRpbWVcclxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0YWcgdGFnXHJcbiAgICAgKi9cclxuICAgIHN0YXJ0KHRhZykge1xyXG4gICAgICBpZiAoIXN0b3B3YXRjaFtwbGF5ZXJzXVt0YWddKSB7XHJcbiAgICAgICAgc3RvcHdhdGNoW3BsYXllcnNdW3RhZ10gPSB7XHJcbiAgICAgICAgICBzdGFydDogX3BlcmZvcm1hbmNlLm5vdygpLFxyXG4gICAgICAgICAgZXhlY1RpbWU6IDAsXHJcbiAgICAgICAgICBzdGF0ZTogc3RhdGVzLnN0YXJ0LFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IHBsYXllciA9IHN0b3B3YXRjaFtwbGF5ZXJzXVt0YWddO1xyXG5cclxuICAgICAgaWYgKHBsYXllci5zdGF0ZSA9PT0gc3RhdGVzLnN0b3ApIHtcclxuICAgICAgICBwbGF5ZXIuZXhlY1RpbWUgPSAwO1xyXG4gICAgICB9XHJcbiAgICAgIHBsYXllci5zdGFydCA9IF9wZXJmb3JtYW5jZS5ub3coKTtcclxuICAgICAgcGxheWVyLnN0YXRlID0gc3RhdGVzLnN0YXJ0O1xyXG4gICAgfSxcclxuXHJcbiAgICAvKipcclxuICAgICAqIFBhdXNlIHRpbWVcclxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0YWcgdGFnXHJcbiAgICAgKi9cclxuICAgIHBhdXNlKHRhZykge1xyXG4gICAgICBpZiAoIXN0b3B3YXRjaFtwbGF5ZXJzXVt0YWddKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihgXCIke3RhZ31cIiBkb2VzIG5vdCBleGlzdGApO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgcGxheWVyID0gc3RvcHdhdGNoW3BsYXllcnNdW3RhZ107XHJcblxyXG4gICAgICBsZXQgcnVuVGltZSA9IDA7XHJcbiAgICAgIGlmIChwbGF5ZXIuc3RhdGUgPT09IHN0YXRlcy5zdGFydCkge1xyXG4gICAgICAgIHJ1blRpbWUgPSBfcGVyZm9ybWFuY2Uubm93KCkgLSBwbGF5ZXIuc3RhcnQ7XHJcbiAgICAgICAgcGxheWVyLmV4ZWNUaW1lICs9IHJ1blRpbWU7XHJcbiAgICAgIH1cclxuICAgICAgcGxheWVyLnN0YXRlID0gc3RhdGVzLnBhdXNlO1xyXG5cclxuICAgICAgcmV0dXJuIHJ1blRpbWU7XHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogU3RvcCB0aW1lXHJcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdGFnIHRhZ1xyXG4gICAgICovXHJcbiAgICBzdG9wKHRhZykge1xyXG4gICAgICBpZiAoIXN0b3B3YXRjaFtwbGF5ZXJzXVt0YWddKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihgXCIke3RhZ31cIiBkb2VzIG5vdCBleGlzdGApO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgcGxheWVyID0gc3RvcHdhdGNoW3BsYXllcnNdW3RhZ107XHJcbiAgICAgIHN0b3B3YXRjaC5wYXVzZSh0YWcpO1xyXG4gICAgICBwbGF5ZXIuc3RhdGUgPSBzdGF0ZXMuc3RvcDtcclxuICAgICAgY29uc29sZS5sb2coYCR7dGFnfTogJHtwbGF5ZXIuZXhlY1RpbWV9bXNgKTtcclxuICAgICAgcmV0dXJuIHBsYXllci5leGVjVGltZTtcclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTdXNwZW5kcyB0aGUgZXhlY3V0aW9uXHJcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gbXMgTnVtYmVyIG9mIG1pbGxpc2Vjb25kXHJcbiAgICAgKi9cclxuICAgIHNsZWVwKG1zKSB7XHJcbiAgICAgIGNvbnN0IHN0YXJ0ID0gRGF0ZS5ub3coKTtcclxuICAgICAgd2hpbGUgKERhdGUubm93KCkgLSBzdGFydCA8IG1zKSB7fVxyXG4gICAgfSxcclxuXHJcbiAgICAvKipcclxuICAgICAqIExpc3QgYWxsIHBhbHllcnNcclxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gcGFseWVyc1xyXG4gICAgICovXHJcbiAgICBsaXN0KCkge1xyXG4gICAgICBjb25zdCBjb3B5ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShzdG9wd2F0Y2hbcGxheWVyc10pKTtcclxuICAgICAgY29uc29sZS5sb2coY29weSk7XHJcbiAgICAgIHJldHVybiBjb3B5O1xyXG4gICAgfSxcclxuXHJcbiAgICAvKipcclxuICAgICAqIENsZWFyIGFsbCBwYWx5ZXJzXHJcbiAgICAgKi9cclxuICAgIGNsZWFyKCkge1xyXG4gICAgICBzdG9wd2F0Y2hbcGxheWVyc10gPSB7fTtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9LFxyXG4gIH0pO1xyXG5cclxuICByZXR1cm4gc3RvcHdhdGNoO1xyXG59XHJcbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7RUFBQSxJQUFJLE1BQU0sR0FBRyxJQUFJLFFBQVEsQ0FBQyxvREFBb0QsQ0FBQyxDQUFDO0VBQ2hGLElBQUksU0FBUyxHQUFHLElBQUksUUFBUTtFQUM1QixFQUFFLG1EQUFtRDtFQUNyRCxDQUFDLENBQUM7O0VBRUYsSUFBSSxZQUFZLEdBQUcsSUFBSTtFQUN2QixFQUFFLE9BQU8sR0FBRyxJQUFJLENBQUM7O0VBRWpCLElBQUksTUFBTSxFQUFFLEVBQUU7RUFDZCxFQUFFLFlBQVksR0FBRyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUMsV0FBVyxDQUFDO0VBQ25ELEVBQUUsT0FBTyxHQUFHLE1BQU0sQ0FBQztFQUNuQixDQUFDLE1BQU0sSUFBSSxTQUFTLEVBQUUsRUFBRTtFQUN4QixFQUFFLFlBQVksR0FBRyxXQUFXLENBQUM7RUFDN0IsRUFBRSxPQUFPLEdB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
